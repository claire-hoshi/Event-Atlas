<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Create Event</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" />
  <link rel="stylesheet" href="style.css?v=20251025-2" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/flatpickr.min.css" />
  <!-- Leaflet CSS for location picker -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
</head>
<body class="create-event-page">
  <!-- Global Left Rail Navigation (static across pages) -->
  <div class="left-rail" id="left-rail" aria-label="Navigation">
    <div class="nav-row">
      <button id="rail-home-btn" class="rail-btn event-style" title="Home" aria-label="Home">
        <i class="home icon"></i>
      </button>
    </div>
    <div class="nav-row">
      <button id="rail-create-btn" class="rail-btn event-style" title="Create Event" aria-label="Create Event">
        <i class="plus icon"></i>
      </button>
    </div>
    <div class="nav-row">
      <button id="rail-drafts-btn" class="rail-btn" title="My Drafts" aria-label="My Drafts">
        <i class="save outline icon"></i>
      </button>
    </div>
    <div class="nav-row">
      <button id="rail-report-btn" class="rail-btn" title="Report" aria-label="Report an issue">
        <i class="flag outline icon"></i>
      </button>
    </div>
    <div class="nav-row">
      <button id="rail-admin-btn" class="rail-btn" title="Admin Console" aria-label="Admin Console">
        <i class="shield alternate icon"></i>
      </button>
    </div>
    <div class="rail-spacer"></div>
    <div class="nav-row">
      <button id="rail-profile-btn" class="rail-btn" title="Profile & Settings" aria-label="Open Profile">
        <img id="rail-avatar" alt="avatar" />
        <i class="user outline icon"></i>
      </button>
    </div>
    
  </div>
  <section>
    <div class="ui segment" style="width:100%; max-width:960px; margin:0 auto;">
      <div class="section-title" id="event-form-title">Event Details</div>
      <div class="account-panel" id="event-form-section">
        <form class="ui form" id="event-form" novalidate>
          <div class="event-grid">
            <div class="field">
              <label>Event Title *</label>
              <input type="text" id="event-title" placeholder="Enter event title" required />
            </div>
            <div class="field">
              <label>Organization *</label>
              <input type="text" id="event-org" placeholder="Your organization/department" required />
            </div>

            <div class="field">
              <label>Category *</label>
              <select id="event-category" required>
                <option value="" disabled selected>Select category</option>
                <option value="Academic">Academic</option>
                <option value="Arts">Arts</option>
                <option value="Athletics">Athletics</option>
                <option value="Community">Community</option>
                <option value="Social">Social</option>
              </select>
            </div>
            <div class="field">
              <label>Contact Email *</label>
              <input type="email" id="event-contact" placeholder="Contact email" required />
            </div>

            <div class="field">
              <label>Start Date & Time *</label>
              <div class="ui right icon input datetime-input">
                <input type="text" id="event-start" required placeholder="Select date and time" />
                <i class="calendar alternate outline icon" id="event-start-icon" aria-hidden="true" title="Pick date & time"></i>
              </div>
              <input type="hidden" id="event-start-iso" />
            </div>
            <div class="field">
              <label>End Date & Time *</label>
              <div class="ui right icon input datetime-input">
                <input type="text" id="event-end" required placeholder="Select date and time" />
                <i class="calendar alternate outline icon" id="event-end-icon" aria-hidden="true" title="Pick date & time"></i>
              </div>
              <input type="hidden" id="event-end-iso" />
            </div>

            <div class="field">
              <label>Max Attendees</label>
              <input type="number" id="event-max" min="1" placeholder="Optional" />
            </div>
            <div class="field">
              <label>Event Image</label>
              <input type="file" id="event-image" accept="image/*" />
            </div>
          </div>

          <div class="section-title" style="margin-top:12px;">Location *</div>
          <div class="event-grid">
            <div class="field">
              <label>Choose Building</label>
              <select id="event-building">
                <option value="">Select a building (optional)</option>
              </select>
            </div>
            <div class="field">
              <label>Location Name *</label>
              <input type="text" id="event-location-name" placeholder="e.g., Julian Science Center Room 140" required />
            </div>
            <!-- Hidden lat/lng to be set by building selection -->
            <input type="hidden" id="event-lat" />
            <input type="hidden" id="event-lng" />
            <div class="field" style="grid-column: 1 / -1;">
              <div id="location-map" class="location-map" aria-label="Pick a location on map"></div>
              <div id="coords-readout" style="margin-top:6px;color:#6b7280;font-size:0.95rem;">Click the map to drop a pin.</div>
            </div>
          </div>

          <div class="field" style="grid-column: 1 / -1;">
            <label>Description</label>
            <textarea id="event-desc" rows="4" placeholder="Describe your event..."></textarea>
          </div>

          <div class="section-title" style="margin-top:12px;">Registration (optional)</div>
          <div class="event-grid">
            <div class="field" style="grid-column: 1 / -1; display:flex; align-items:center; gap:10px;">
              <input type="checkbox" id="event-rsvp-required" />
              <label for="event-rsvp-required" style="margin:0;">Require RSVP for this event</label>
            </div>
          </div>

          <div class="ui warning message" id="event-guard" style="display:none;">Only organizers can create events.</div>
          <div class="ui error message" id="event-error" style="display:none;"></div>
          <div class="ui positive message" id="event-success" style="display:none;">Done!</div>

          <div style="display:flex; justify-content:flex-end; align-items:center; gap:8px; flex-wrap:wrap; width:100%;">
            <div style="display:flex; gap:8px; flex-wrap:wrap;">
              <button class="ui button" id="event-save-changes" type="button" style="display:none;">Save Changes</button>
              <button class="ui button red" id="event-discard" type="button" style="display:none;">Discard</button>
              <button class="ui button" id="event-save-draft" type="button">Save Draft</button>
              <button class="ui button" id="event-submit" type="submit">Publish Event</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </section>

  <!-- Confirm Leave Modal -->
  <div id="confirm-leave-modal" class="confirm-modal" style="display:none;" aria-hidden="true" role="dialog" aria-label="Save changes?">
    <div class="confirm-backdrop" id="confirm-leave-backdrop"></div>
    <div class="confirm-card" role="document">
      <div class="confirm-title">Save Changes?</div>
      <div class="confirm-actions">
        <button id="confirm-discard" class="ui button">Discard</button>
        <button id="confirm-save" class="ui button primary">Save</button>
      </div>
    </div>
  </div>

  <script src="firebase.js?v=20251025-2" type="module"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/flatpickr.min.js"></script>
  <!-- Leaflet JS for map picker -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>
  <script src="event.js?v=20251025-7" type="module"></script>
  <script src="nav.js?v=20251025-2" type="module"></script>
</body>
</html>
